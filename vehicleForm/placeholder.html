<!doctype html>
<html lang="en">

    <head>
        <!-- <meta charset="utf-8"> -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset = "UTF-8">
        <title>Emissions Explorer Tool</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <!-- CSS -->
        <link href="../css/main.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/style.css" type="text/css">
        <link rel="stylesheet" href="../css/styleForm.css" type="text/css">
        <!-- Observable -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@observablehq/inspector@5/dist/inspector.css">
        <!-- AJAX -->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    </head>

    <body>
        <div class="customTitleEquityImage">

            <div class="col-12"> <!-- begin nav bar -->
              <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                  <a class="" href="#"></a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
                    <ul class="nav">
                      <li class="nav-item">
                        <a class="nav-link customNavItem" href="../templates/index.html">Home</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link active customNavItem" aria-current="page" href="../vehicleForm/vehicle_form.html">Emissions Explorer</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link customNavItem" href="../templates/equity.html">Accessibility</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link customNavItem" href="../templates/about.html">About</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </nav>  
            </div> <!-- end nav bar -->
        
              <div class="container-md" style="max-width: 1050px;">
                <div class="row pb-5 d-flex align-items-center" style="height: 200px;">
                  <div class="col-12 p-5 customTitleText">
                    <h1 class="customTitleText" id="header">Our Emissions Explorer Tool</h1>
                  </div> <!-- end col -->
                </div> <!-- end row -->
              </div> <!-- end container -->

        </div> <!-- end header section -->      
        <!-- <h1 id = "header"> Vehicle Emissions Form</h1> -->

        <div class="customGradient py-5">

            <div class="container-md pb-5 my-5 bg-white shadow" style="max-width: 1050px;">
              <div class="row pt-5">
                <div class="col-12 pt-3 px-5">
                  <h3>How we built Emissions Explorer</h3>
                </div> <!-- end col -->
              </div> <!-- end row -->

              <div class="row pt-2">
                <div class="col-12 pt-3 px-5">
                  <p>Emissions Explorer estimates the lifetime emissions of a specific vehicle model based on the GREET life cycle analysis. 
                    <br><br>
                    GREET Model ------
                    <br><br>
                    Factors taken into consideration 
                    <ul>
                        <li>Year of the Vehicle</li>
                        <li>Vehicle Model</li>
                        <li>Where you live </li>
                    </ul>
                    <br>
                    This is where we got the data 
                    <br><br>
                    These are the assumptions we made
                  </p>
                </div> <!-- end col -->
              </div> <!-- end row -->

              <div class="row pt-2">
                <div class="col-12 pt-3 px-5">
                    <!-- DESCRIPTION OF THE CHART -->
                    <hr class="border border-secondary border-1 opacity-100" /> 
                    <h5>Drag the bar to a year to see lifetime emissions of vehicle models released <br> compared to vehicle models released in 2000. 
                    </h5>
                    <hr class="border border-secondary border-1 opacity-100" /> 
                    <br>
                    <!-- END -- DESCRIPTION OF THE CHART -->
                </div> <!-- end col -->
              </div> <!-- end row -->
              <div class="row pb-5">
                <div class="col-12 p-5 bg-dark-subtle" style="height: 500px">
                    <br>

                </div> <!-- end col -->
              </div> <!-- end row -->
            </div> <!-- end container -->

            <div class="container-md mt-5 pb-5 bg-white shadow" style="max-width: 1050px;">
                <div class="row pt-5">
                  <div class="col-12 pt-3 px-5">
                    <h3>How does lifetime emissions of vehicles compare based on:</h3>
                  </div> <!-- end col -->
                </div> <!-- end row -->
                <div class="row pt-5">
                    <div class="col-12 px-5 text-center">
                      <h3>1. Year</h3>
                      <p class="pt-2">Comparing the same vehicle model over time, the lifetime emissions decreased for the newer model.</p>
                    </div> <!-- end col -->
                  </div> <!-- end row -->
                <div class="row pb-2 justify-content-around">
                    <div class="col-6 ps-5 pe-2" style="height: 400px">
                        <h5 class="text-center">2017 Volkswagen Tiguan (ICE)</h5>
                        <div class="text-center py-2 ">
                            <img src="../static/images/comparison/2017Tiguan.jpg" class="w-50 h-auto rounded-3">
                        </div>
                        <p>
                            Lifetime Emissions: 78,328.52 kgCO2e
                            <br>
                            Lifetime Emissions of burining ~58 standard pickup trucks of coal
                        </p>
                    </div> <!-- end col -->
                    <div class="col-6 ps-2 pe-5" style="height: 400px">
                        <h5 class="text-center">2023 Volkswagen Tiguan (ICE)</h5>
                        <div class="text-center py-2">
                            <img src="../static/images/comparison/2023Tiguan.png" class="w-50 h-auto rounded-3">
                        </div>
                        <p>
                            Lifetime Emissions: 66,975 kgCO2e
                            <br>
                            Lifetime Emissions of burining ~49 standard pickup trucks of coal
                        </p>
                    </div> <!-- end col -->
                  </div> <!-- end row -->
                  <div class="row pb-5 justify-content-around">
                    <div class="col-5 p-5 bg-dark-subtle" style="height: 400px">
                    </div> <!-- end col -->
                    <div class="col-5 p-5 bg-dark-subtle" style="height: 400px">
                    </div> <!-- end col -->
                  </div> <!-- end row -->
              </div> <!-- end container -->

          </div> <!-- end gradient section -->

        <div class="customGradientReverse pb-5">
            <div class="container-md bg-white mb-5 shadow" style="max-width: 1050px;">
              <div class="row pb-1">
                <div class="col-12 px-5 pt-5 text-center">
                  <h3>Calculate Lifetime Emissions for a Vehicle - Your Choice!</h3>
                  <!-- <p><br>Cupcake oat cake lemon drops tiramisu tiramisu dessert chupa chups caramels gummi bears. Wafer lollipop candy canes pie carrot cake oat cake pie cake. Chocolate cake gummies biscuit carrot cake candy canes bear claw sesame snaps powder. Pastry wafer shortbread drag√©e lollipop.</p> -->
                </div> <!-- end col -->
              </div> <!-- end row -->
              <div class="row pb-5">
                <div class="col-12 p-5" style="">
                    <form>
                        <!-- <form  onsubmit="showOutput()"> -->
                        <div class="row mb-5">
                            <div class="col-auto">
                                <img src="../static/images/emissionsExplorer/1.png" class="" style="width: 50px; height: 50px">
                            </div>
                            <div class="col-auto">
                                <label for="zip" class="form-label">Zip Code:</label>
                                <input type="text" class="form-control" id="zip" value="00000" min="00000" max="99999" minlength = "5" maxlength="5" required pattern="\d{5,5}" oninput = "showZip()"/> 
                                <div id="zipHelp" class="form-text">Location is key for us to calculate your emissions based on your local grid.</div>
                            </div>
                        </div>
                        <!-- <span>
                            Zip Code: <input type="text" id="zip" value="00000" min="00000" max="99999" minlength = "5" maxlength="5" required pattern="\d{5,5}" oninput = "showZip()"/> 
                        </span> -->
                        <div class=" row mb-5">
                            <div class="col-auto">
                                <img src="../static/images/emissionsExplorer/2.png" class="" style="width: 50px; height: 50px">
                            </div>
                            <div class="col-auto">
                                <label for="yearsOwn" class="form-label">Number of years planned on driving:</label>
                                <input type="number" id="yearsOwn" value="17" min="0.1" max="100" oninput = "showYearsown()"/> 
                                <div id="yearsOwnHelp" class="form-text">Text Help</div>
                            </div> <!-- end col -->

                            <div class="col-auto">
                                <label for="milesDrive" class="form-label">Number of miles planned on driving:</label>
                                <input type="text" id="milesDrive" value="178,000" min="0.1" oninput = "showMilesDrive()"/> 
                                <div id="milesDriveHelp" class="form-text">US average is 17 years and 178,000 miles driven over vehicle lifetime.</div>
                            </div> <!-- end col -->
                        </div> <!-- end row -->
                        <!-- <span>
                            Number of years planned on driving: <input type="number" id="yearsOwn" value="17" min="0.1" max="100" oninput = "showYearsown()"/> 
                        </span> -->
                        <!-- <span>
                            Number of miles planned on driving: <input type="number" id="milesDrive" value="178000" min="0.1" oninput = "showMilesDrive()"/> 
                            <p style = "font-size:11px">US average is 17 years and 178000 miles driven.</p>
                        </span> -->
                        <div class=" row mb-4">
                            <div class="col-auto">
                                <img src="../static/images/emissionsExplorer/3.png" class="" style="width: 50px; height: 50px">
                            </div>
                            <div class="col-auto">
                                <label for="selYear" class="form-label">Year</label>
                                <select name = "Selected Year" id="selYear" onchange = "showYear()" required>
                                    <option value="" selected = "selected"> -- Select a Year --</option>
                                </select>
                                <div id="selYearHelp" class="form-text">Text Help</div>
                            </div> <!-- end col -->

                            <div class="col-auto">
                                <label for="selType" class="form-label">Vehicle Type</label>
                                <select name = "Selected Type" id="selType" onchange = "showType()" required>
                                    <option value="" selected = "selected"> -- Select a Year First --</option>
                                </select>                                 
                                <div id="selTypeHelp" class="form-text">ICE, PHEV, BEV</div>
                            </div> <!-- end col -->
                        </div> <!-- end row -->
                        <!-- <span> 
                            Year: <select name = "Selected Year" id="selYear" onchange = "showYear()" required>
                                    <option value="" selected = "selected"> -- Select a Year --</option>
                            </select> 
                         </span> -->
                        <!-- <span>
                            Vehicle Type: <select name = "Selected Type" id="selType" onchange = "showType()" required>
                                    <option value="" selected = "selected"> -- Select a Year First --</option>
                            </select> 
                        </span> -->

                        <div class=" row mb-5">
                            <div class="col-auto">
                                <label for="selMake" class="form-label">Make</label>
                                <select name = "Selected Make" id="selMake" onchange = "showMake()" required>
                                    <option value="" selected = "selected"> -- Select a Type First --</option>
                                </select>
                                <div id="selMakeHelp" class="form-text">Text Help</div>
                            </div> <!-- end col -->

                            <div class="col-auto">
                                <label for="selModel" class="form-label">Vehicle Model</label>
                                <select name = "Selected Make" id="selModel" onchange = "showModel()" required>
                                    <option value="" selected = "selected"> -- Select a Make First --</option>
                                </select>                                 
                                <div id="selModelHelp" class="form-text">Make Help</div>
                            </div> <!-- end col -->

                            <div class="col-auto">
                                <span id = 'configBox'>
                                    Configuration: <span id = "configStart"> <i>Select Vehicle Model First</i></span>
                                    <div id="btn-group">
                                        <button id="bt1" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt1'))" disabled>Config 1</button><br>
                                        <button id="bt2" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt2'))" disabled>Config 2</button><br>
                                        <button id="bt3" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt3'))" disabled>Config 3</button><br>
                                        <button id="bt4" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt4'))" disabled>Config 4</button><br>
                                        <button id="bt5" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt5'))" disabled>Config 5</button><br>
                                        <button id="bt6" type="button" name = "bt" style = "width: 200px; background: whitesmoke;" onclick = "showConfig(document.getElementById('bt6'))" disabled>Config 6</button><br>
                                    </div>
                                </span>
                            </div> <!-- end col -->
                        </div> <!-- end row -->
                        <!-- <span>
                            Make: <select name = "Selected Make" id="selMake" onchange = "showMake()" required>
                                <option value="" selected = "selected"> -- Select a Type First --</option>
                            </select> 
                        </span> -->
                        <!-- <span>
                            Model: <select name = "Selected Make" id="selModel" onchange = "showModel()" required>
                                    <option value="" selected = "selected"> -- Select a Make First --</option>
                                </select> 
                        </span> -->
                        <div class="row">
                            <div class="col-12 text-center">
                                <div id = "firstSubmit">
                                    <button id = "submitbtn" class="btn btn-primary btn-lg mt-4 mx-3 rounded-pill px-5" type="button"  onclick = "showResult()" disabled>Submit</button>
                                </div>
                                <!-- <div id = "secondSubmit" style="display:None">
                                    <button id = "resultsbtn" type="button"  onclick = "showOutput()">View Results</button>
                                </div> -->
                                    <!-- </button>onclick="return calculateEmissions()">Submit  </button> -->
                                    <p id = "warningmessage" style = "font-size:11px; color:red"></p>
                            <br>
                                    <div id = "responses">
                                        <!-- style = "display:None" -->
                                        Responses:<br>
                                        <ol id = "zip_res"></ol>
                                        <ol id = "yearsOwn_res">17</ol>
                                        <ol id = "avg_miles">178000</ol>
                                        <ol id = "subregion"></ol>
                                        <ol id = "CO2eRate"></ol>
                                        <ol id = "year_res"></ol>
                                        <ol id = "type_res"></ol>
                                        <ol id = "make_res"></ol>
                                        <ol id = "model_res"></ol>
                                        <ol id = "config_res"></ol>
                                        <ol id = "yearmakemodel"></ol>
                                        Total Emissions: 
                                        <ol id = "totalEmissions"></ol>
                                        <ol id = "roundedEmissions"></ol>
                                        <ol id = "totalBattery"></ol>
                                        <ol id = "totalVehicle"></ol>
                                        <ol id = "totalUsage"></ol>
                                        <ol id = "totalDisposal"></ol>
                                        Averages:
                                        <ol id = "ICEemissionAvg"></ol>
                                        <ol id = "PHEVemissionAvg"></ol>
                                        <ol id = "BEVemissionAvg"></ol>
                                        US Grid Mix Average:
                                        <ol id = "USICEemissionAvg"></ol>
                                        <ol id = "USPHEVemissionAvg"></ol>
                                        <ol id = "USBEVemissionAvg"></ol>
                                        Year List:
                                        <ol id = "histarray"></ol>
                                    </div>
                            </div> <!-- end col -->
                        </div> <!-- end row -->
                        </form>
                </div> <!-- end col -->
              </div> <!-- end row -->

            </div> <!-- end container -->
        </div> <!-- end container -->

        <div class="customGradient py-5" id = "output" style = "display: None">
            <div class="container-md bg-white shadow" style="max-width: 1050px;">

            <!-- OUTPUTS!! -->
            <div class="row py-5 px-5">
            <div class="col-12">
                <!-- <div id = "output" style = "display: None"> -->
                <h2 id = "vehicleInput">Output Options</h2>
                <h3 id = "totEmissionsOutput"></h3>
                <p id = "vehicleConfig"></p>
            </div> <!-- end col -->
            </div> <!-- end row -->
            <div class="row px-5" style="">
            <div class="col-4" style="">
                <svg id="barChart"style="width:100%; height: 350px"></svg>
            </div> <!-- end col -->
            <div class="col-8" style="">
                    <!-- <svg id="equivalencies" style="width: 600px;height:250px"></svg> -->
                <svg id="equivalencies2" style="width:100%; height: 350px"></svg>
            </div> <!-- end col -->
            <div class="col-12">
                <p style = "">*Note: Averages shown in bar chart are based on zip code, model year, and planned number of years for driving from user inputs. <br> **Note: Emissions calculations for equivalencies are based on US averages.</p>
            </div>
            </div> <!-- end row -->

            <!-- PER MILE EMISSIONS -->
             <div class="row px-5 pt-5" style="">
                <div class="col-12">
                    <h2>Estimated emissions for corresponding travel distance</h2>
                        <!-- <div style="width: 1000px;height:70px"> -->
                    <svg id="avg_text" style="width: 1000px;height:50px"></svg>
                        <!-- </div> -->
                </div> <!-- end col -->

                <div class="col-12">
                    <form>
                        <label for="miles" class="form-label">Enter number of miles:</label>
                        <input type="text" class="form-control" id="miles" value="0" min="0" max="200000" maxlength="6" oninput="return perMileFunction()"/> 
                        <div id="miles" class="form-text">Minimum Number of Miles: 1, Maximum: 200,000</div>
                        <!-- <button type="button" onclick="return perMileFunction()">Enter  </button> -->
                    </form>
                    <div style="width: 300px;height:10px">
                        <span style = "font-size:11px; color:red" id="check_input"></span>
                    </div>
                </div> <!-- end col -->

                <div class="col-12 pt-4">
                    <h5>Estimated Emissions</h5>
                    <span id="emissions-output"></span> 
                    <div >
                        This is equivalent to emissions from burning:
                    <b> <span id="emissions-equi"></span> </b>
                    <p style = "font-size:10px">Note: This estimate is based on overall LCA. The actual emissions per mile will depend on a variaty of factors including road condition, weather, speed, etc.</p>
                    </div>
            
                    <!-- ISOTOPES -->
                    <div style="width: 1000px;height:300px">
                        <svg id="isotopes" style="width: 1000px;height:300px"></svg>
                    </div>
                </div> <!-- end col -->
             </div> <!-- end row -->

            </div> <!-- end container -->
        </div> <!-- end reverse gradient -->

        <div class="customFooter">
            <div class="container-md" style="max-width: 1050px;">
              <div class="row">
                <div class="col-8 p-5">
                  Astoria Ho, Clara Hu, Josh Everts -- MIMS '23 Capstone Project
                </div> <!-- end col -->
              </div> <!-- end row -->
            </div> <!-- end container -->
          </div> <!-- end footer section -->

    </body>
    

<script src="https://d3js.org/d3.v6.js"></script>
<script src="outputs.js" type="text/javascript"></script>

    <!-- <script type = "module" src = "test_form.js"></script> -->
    <script>
     
    var myArray = []
    var avg_CO2eRate = []
    var avg_miles = 178000

        $.ajax({
            method:"GET",
            url:'./json/vehicle_data_2023.json',
            success:function(response) {
                myArray = response
                // buildTable(myArray)
                populateSelectYear(myArray)
            }
        });

        $('#zip').on('click', function() {
            $('#secondSubmit').hide();
            $('#output').hide()
        })

        $('#zip').on('change', function() {
            $.ajax({
            method:"GET",
            url:'./json/zip_to_subregion.json',
            success:function(response) {
                showSubregion(response);
                avg_CO2eRate = Number(document.getElementById("CO2eRate").innerHTML); //grid intensity
            }
        })
            $('#output').hide()
            $('#secondSubmit').hide();
        });


        $('#yearsOwn').on('click', function() {
            $('#secondSubmit').hide();
            $('#output').hide()
        })


        $('#yearsOwn').on('change', function() {
            $('#secondSubmit').hide();
            $('#output').hide()
        })

        $('#milesDrive').on('click', function() {
            $('#secondSubmit').hide();
            $('#output').hide()
        })

        $('#milesDrive').on('input', function() {
            var removeChar = this.value.replace(/[^0-9\.]/g, '') // This is to remove alphabets and special characters.
            // console.log(removeChar);
            var removeDot = removeChar.replace(/\./g, '') // This is to remove "DOT"
            this.value = removeDot
    
            var formatedNumber = this.value.replace(/\B(?=(\d{3})+(?!\d))/g, ",")
            // console.log(formatedNumber);
            this.value = formatedNumber
        })


        $('#milesDrive').on('change', function() {
            $('#secondSubmit').hide();
            $('#output').hide()
            avg_miles = Number(document.getElementById("avg_miles").innerHTML.split(',').join("")); //miles_estimated
        })



        $('#selYear').on('change', function() {
            $.ajax({
            method:"GET",
            url:'./json/vehicle_data_2023.json',
            success:function(response) {
                clearSelectMake();
                clearSelectModel();
                clearSelectConfig();
                document.getElementById("type_res").innerHTML = "";
                populateSelectType(response)
            }
        })
             $('button[name = "bt"]').attr("disabled", true);
            $('#submitbtn').attr("disabled", true);
            $('button[name = "bt"]').css("background-color", 'whitesmoke');
            $('#configStart').show();
            $('#secondSubmit').hide();
            $('#output').hide()
        });
        
        
        $('#selType').on('change', function() {
            $.ajax({
            method:"GET",
            url:'./json/vehicle_data_2023.json',
            success:function(response) {
                clearSelectModel()
                clearSelectConfig()
                populateSelectMake(response)
                document.getElementById("make_res").innerHTML = "";
            }
        })
            $('button[name = "bt"]').attr("disabled", true);
            $('#submitbtn').attr("disabled", true);
            $('button[name = "bt"]').css("background-color", 'whitesmoke');
            $('#configStart').show();
            $('#secondSubmit').hide();
            $('#output').hide()
        });


        $('#selMake').on('change', function() {
            $.ajax({
            method:"GET",
            url:'./json/vehicle_data_2023.json',
            success:function(response) {
                document.getElementById("model_res").innerHTML = "";
                clearSelectConfig()
                populateSelectModel(response)
            }
        })
            $('button[name = "bt"]').attr("disabled", true);
            $('#submitbtn').attr("disabled", true);
            $('button[name = "bt"]').css("background-color", 'whitesmoke');
            $('#configStart').show();
            $('#secondSubmit').hide();
            $('#output').hide()
        });

        $('#selModel').on('change', function() {
            $.ajax({
            method:"GET",
            url:'./json/vehicle_data_2023.json',
            success:function(response) {
                populateSelectConfig(response)
                showConfig(document.getElementById('bt1'))
                showVehicle(response);
            }
        })
            // $('#btn-group').show();
            //$('.bt').show();
            $('#configStart').hide();
            $('button[name = "bt"]').css("background-color", 'whitesmoke');
            $('#bt1').css('background-color', '#46B5B5');
            $('#submitbtn').attr("disabled", false);
            $('#secondSubmit').hide();
            $('#output').hide();
        });


        $('button[name = "bt"]').on('click', function() {
            $('button[name = "bt"]').css("background-color", 'whitesmoke');
            $(this).css('background-color', '#46B5B5');
            $('#secondSubmit').hide();
            $('#output').hide();
            }
        );

    const US_CO2Rate_avg = 857 * 453.592 / 1000

    var vehicle_data = []
    var manufacturing_data = []
    var battery_data = []
    var vehicle_emissions_array = []

    var iceList = []
    var phevList = []
    var bevList = []
    var yearList = []

    var avgICE = []
    var avgPHEV = []
    var avgBEV = []

    var USavgICE = []
    var USavgPHEV = []
    var USavgBEV = []
    var yearEmissions = []


        $('#submitbtn').on('click', function() {
            // avg_miles = 178000 / 17 * Number(document.getElementById("yearsOwn_res").innerHTML); //miles_estimated
            // document.getElementById("avg_miles").innerHTML = avg_miles
            ajaxCall1();
            $('html,body').animate({
            scrollTop: $("#output").offset().top},
            'slow');
            // return outputViz();
            //$('#secondSubmit').show();
        })


        // $('#resultsbtn').on('click', function() {
        //     $('html,body').animate({
        //     scrollTop: $("#output").offset().top},
        //     'slow');
        //     return outputViz();
        // });


        $('#miles').on('input', function() {
            var removeChar = this.value.replace(/[^0-9\.]/g, '') // This is to remove alphabets and special characters.
            // console.log(removeChar);
            var removeDot = removeChar.replace(/\./g, '') // This is to remove "DOT"
            this.value = removeDot
    
            var formatedNumber = this.value.replace(/\B(?=(\d{3})+(?!\d))/g, ",")
            // console.log(formatedNumber);
            this.value = formatedNumber
        })


function showVehicle(full_data) {
    var data = getVehicle(full_data)
    // var table = document.getElementById('emissions')
    const x = `${data.Year} ${data.Make} ${data.Model}`// ${data[0].Model} ${data[0].Config}`
    document.getElementById("yearmakemodel").innerHTML = x
}





/////Select Year///////

    function initSelect(data) {
        let ele = document.getElementById('selYear');
        ele.innerHTML = "";
        populateSelectYear(data)
    }

    function populateSelectYear(data) {

    let ele = document.getElementById('selYear');
    var years = []
    for (let i = 0; i < data.length; i++) {
      // populate select element with json.
      years.push(data[i].Year)
    }
    var uniqueYears = years.filter((value, index, self) => self.indexOf(value) === index);
    uniqueYears.sort();
    uniqueYears.reverse();
    for (let i = 0; i < uniqueYears.length; i++) {
        ele.innerHTML = ele.innerHTML +
        //  '<option value="' + data[i].id + '">' + data[i].Year + '</option>';
        '<option>' + uniqueYears[i] + '</option>';
       // '<option value="' + data[i].id + '">' + uniqueYears[i] + '</option>';
    }
  }


//////SELECT TYPE

  function populateSelectType(full_data) {

    let ele = document.getElementById('selType');
    ele.innerHTML = '<option>' + "-- Select Vehicle Type --" + '</option>';
    var types = []
    let year = document.getElementById('selYear')
    var year_data = year.options[year.selectedIndex].text
    var data = full_data.filter(function (el) {
        return el.Year.toString() === year_data
    })
    for (let i = 0; i < data.length; i++) {
  // populate select element with json.
      types.push(data[i].atvType)
    }
    var uniqueTypes = types.filter((value, index, self) => self.indexOf(value) === index);
    uniqueTypes.sort();
    for (let i = 0; i < uniqueTypes.length; i++) {
    ele.innerHTML = ele.innerHTML +
    //'<option >' + year + '</option>';
    '<option>' + uniqueTypes[i] + '</option>';
    }
  }



  //////SELECT MAKE

  function populateSelectMake(full_data) {

    let ele = document.getElementById('selMake');
    ele.innerHTML = '<option>' + "-- Select Make -- " + '</option>';
    var makes = []
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    let type = document.getElementById("selType")
    var type_data = type.options[type.selectedIndex].text
    var data = full_data.filter(function (el) {
        return el.Year.toString() === year_data && el.atvType === type_data
    })
    for (let i = 0; i < data.length; i++) {
// populate select element with json.
        makes.push(data[i].Make)
    }
    var uniqueMakes = makes.filter((value, index, self) => self.indexOf(value) === index);
    uniqueMakes.sort();
    for (let i = 0; i < uniqueMakes.length; i++) {
    ele.innerHTML = ele.innerHTML +
    '<option>' + uniqueMakes[i] + '</option>';
    //'<option>' + data.options[data.selectedIndex].text + '</option>';
    }
    }

     //////SELECT MODEL

  function populateSelectModel(full_data) {

    let ele = document.getElementById('selModel');
    ele.innerHTML = '<option>' + "-- Select Model -- " + '</option>';
    var models = []
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    let type = document.getElementById("selType")
    var type_data = type.options[type.selectedIndex].text
    let make = document.getElementById("selMake")
    var make_data = make.options[make.selectedIndex].text
    var data = full_data.filter(function (el) {
         return el.Year.toString() === year_data  && el.atvType === type_data && el.Make === make_data
    })
    for (let i = 0; i < data.length; i++) {
        // populate select element with json.
        models.push(data[i].Model)
    }
    var uniqueModels = models.filter((value, index, self) => self.indexOf(value) === index);
    uniqueModels.sort();
    for (let i = 0; i < uniqueModels.length; i++) {
    ele.innerHTML = ele.innerHTML +
    '<option>' + uniqueModels[i] + '</option>';
    //'<option>' + data.options[data.selectedIndex].text + '</option>';
    }
  }


     //////SELECT Configuration

///////CONFIG 
function populateSelectConfig(full_data) {

// document.getElementById('selConfig').hide();
// let ele = document.getElementById('selModel');
// ele.innerHTML = '<option>' + "-- Select Model -- " + '</option>';
var configs = []
let year = document.getElementById("selYear")
var year_data = year.options[year.selectedIndex].text
let type = document.getElementById("selType")
var type_data = type.options[type.selectedIndex].text
let make = document.getElementById("selMake")
var make_data = make.options[make.selectedIndex].text
let model = document.getElementById("selModel")
var model_data = model.options[model.selectedIndex].text
var data = full_data.filter(function (el) {
    return el.Year.toString() === year_data  && el.atvType === type_data && el.Make === make_data && el.Model === model_data
})
for (let i = 0; i < data.length; i++) {
    // populate select element with json.
    configs.push(data[i].Config)
}
// var uniqueConfigs = configs.filter((value, index, self) => self.indexOf(value) === index);
for (let i = 0; i < configs.length; i++) {
    let ele = document.getElementById(`bt${i+1}`)
    ele.value = configs[i];
    ele.innerHTML = configs[i];
    ele.disabled = false;
}
// let ele = document.getElementById('config0')
// ele.checked = true;
}


//// CLEARING FIELDS


    function clearSelectMake() {

        let ele = document.getElementById('selMake');
        ele.innerHTML = '<option>' + "--Select a Type First--" + '</option>';
        document.getElementById("make_res").innerHTML = "";
    };

    function clearSelectModel() {

        let ele = document.getElementById('selModel');
        ele.innerHTML = '<option>' + "--Select a Make First--" + '</option>';
        document.getElementById("model_res").innerHTML = "";
    };

    function clearSelectConfig() {

        // document.getElementsByClassName('bt').style.background = 'whitesmoke';
        // document.getElementsByClassName('bt').disabled = true;
        document.getElementById("config_res").innerHTML = "";
    };

/////////////////////////////////// Getting values /////////////////////////////////////////
  function showZip() {
        const x = document.getElementById("zip").value 
        document.getElementById("zip_res").innerHTML = x
    } 
  function showYearsown() {
        const x = document.getElementById("yearsOwn").value 
        document.getElementById("yearsOwn_res").innerHTML = x
    } 

function showMilesDrive() {
        const x = document.getElementById("milesDrive").value 
        document.getElementById("avg_miles").innerHTML = x
    } 

  function showYear() {
        let year = document.getElementById('selYear')
        document.getElementById("year_res").innerHTML = year.options[year.selectedIndex].text
    }  
  function showType() {
        let type = document.getElementById('selType')
        document.getElementById("type_res").innerHTML = type.options[type.selectedIndex].text
    }  
  function showMake() {
        let make = document.getElementById('selMake')
        document.getElementById("make_res").innerHTML = make.options[make.selectedIndex].text
    }
  function showModel() {
        let model = document.getElementById('selModel')
        document.getElementById("model_res").innerHTML = model.options[model.selectedIndex].text
    } 
  function showConfig(button) {
        document.getElementById("config_res").innerHTML = button.value
    }

  function showSubregion(full_data) {
        let zip_data = document.getElementById('zip_res').innerHTML;
        var data = full_data.filter(function (el) {
            return el.ZIP === parseInt(zip_data)
        })
        document.getElementById("subregion").innerHTML = data[0].Subregion1
        var subregion = subregion_CO2e.filter(function (el) {
            return el.Region_code === data[0].Subregion1
        })
        document.getElementById("CO2eRate").innerHTML = subregion[0].CO2eRate * 453.592 / 1000 //g/kWh
    }


/////////////////////////////// SHOW OUTPUT//////////////////////////////////

    function showOutput() {
        var x = document.getElementById("output");
        x.style.display = "block";
    }
    
    function showResult() {
        var x = parseInt(document.getElementById("zip_res").innerHTML)
        if (!zip_list.includes(x)) {
            var x = document.getElementById("warningmessage");
            x.style.display = "block"
            // var y = document.getElementById("secondSubmit");
            // y.style.display = "none"
            return document.getElementById("warningmessage").innerHTML = "Zip Code not found. Please double check your 5-digit zip code!"
        }
        else if (avg_miles > 1000000) {
            var x = document.getElementById("warningmessage");
            x.style.display = "block"
            // var y = document.getElementById("secondSubmit");
            // y.style.display = "none"
            return document.getElementById("warningmessage").innerHTML = "The maximum number of miles planned on driving is 1,000,000."
        } else if (document.getElementById("zip").value.match(/\d{5,5}/)) {
            var x = document.getElementById("warningmessage");
            x.style.display = "none"
            // var y = document.getElementById("secondSubmit");
            // y.style.display = "block"
            showOutput();
        }  else {
            var x = document.getElementById("warningmessage");
            x.style.display = "block"
            // var y = document.getElementById("secondSubmit");
            // y.style.display = "none"
            document.getElementById("warningmessage").innerHTML = "Zip Code not found. Please double check your 5-digit zip code!"
    }
    }

////////////////////////////// EMISSIONS CALCULATIONS ///////////////////////

function est_battery_capacity_from_vehicle(Vehicle) {
    // return battery capacity in kwh
    var kwh_size = 0
    if (Vehicle.atvType === 'EV') {
        var kwh_size = Vehicle.Range*(1/Vehicle.Highway08U)*33.7 // use Range since all EVs have it
    } else if (Vehicle.atvType === 'PHEV') {
        var kwh_size = Vehicle.RangeHwyA*(Vehicle.combE/100) // range*(kWh/100 miles) = kWh estimated
    }
    return kwh_size
}

function est_battery_weight_from_vehicle(Vehicle) {
    //return battery weight in lbs
    var battery_weight = est_battery_capacity_from_vehicle(Vehicle)*1/(.2)*2.204 // assume 0.2 kWh/Kg energy density
    return battery_weight
}

function est_battery_assembly_emissions(Vehicle, emittant) {
    const battery_assembly_dict = [{'pollutant':'VOC', 'emission': 2.24}, {'pollutant':'CO', 'emission': 9.129}, 
                        {'pollutant':'NOx', 'emission': 13.081}, {'pollutant':'PM10', 'emission': 0.939},
                        {'pollutant':'PM2.5', 'emission': 0.747}, {'pollutant':'SOx', 'emission': 3.981}, 
                        {'pollutant':'BC', 'emission': 0.099}, {'pollutant':'OC', 'emission': 0.279}, 
                        {'pollutant':'CH4', 'emission': 37.428}, {'pollutant':'N2O', 'emission': 0.361},
                        {'pollutant':'CO2', 'emission': 12374}]
    var emittant_emi = battery_assembly_dict.filter(function (el) {
        return el.pollutant === emittant
    })
    var battery_assembly_emissions = est_battery_capacity_from_vehicle(Vehicle) * emittant_emi[0].emission
    return battery_assembly_emissions
}


function weighted_emissions_calc(vehicle_weight, mass_fractions, emissions_vector) {
    // var mass_fractions_array = [] 
    // var emissions_vector_array = []
    // for (let i = 0; i < mass_fractions.length; i++) {
    //     mass_fractions_array.push(mass_fractions[i])
    //     emissions_vector_array.push(emissions_vector[i])
    // }
    function emissionsCalc(a,b){
        return a.map((e,i) => e * b[i] * vehicle_weight);
    }
    var weighted_emissions_array = emissionsCalc(mass_fractions, emissions_vector)
    var weighted_emissions = weighted_emissions_array.reduce((partialSum, a) => partialSum + a, 0)
    return weighted_emissions
}

function get_PHEV_usage_emissions(Vehicle, miles_estimated, grid_intensity) {
    //implement PHEV emissions calculation using EPA utility factor
    var utility_factor = Vehicle.combinedUF
    var electric_eff = Vehicle.combE // in kwh/100 miles (average energy consumption in both hybrid and EV modes)
    var permile_electric_eff = electric_eff / 100
    var combined_mpge = Vehicle.comb08

    var grid_carbon = grid_intensity * permile_electric_eff * miles_estimated 
    var fuel_carbon = (combined_mpge ** -1) * miles_estimated * 8900 
    // consumption in hybrid mode (EV mode is zero fuel)

    var PHEV_usage_emissions = 1 / ((1 / grid_carbon) + (1 - utility_factor) / fuel_carbon) 
    // electric_eff always applies (no weight)
    return PHEV_usage_emissions
}

// ##
// ## need to fix this to work with Hybrid vehicles (how to estimate HEV battery size?)
// ## update to also work with lightweight versions correctly
// ##


function get_embodied_emissions(vehicle_weight, battery_weight, vehicle_type, 
    emissions_type, vehicle_emissions_manufacturing, battery_emissions_manufacturing) {
        
    var veh_mass_fraction = []
    var veh_emissions_vector = []
    var batt_emissions_vector = []
    var batt_mass_fraction = []
    for (let i = 0; i < vehicle_emissions_manufacturing.length; i++) {
        veh_mass_fraction.push(vehicle_emissions_manufacturing[i][emissions_type])
        veh_emissions_vector.push(vehicle_emissions_manufacturing[i][vehicle_type])
    }
    for (let i = 0; i < battery_emissions_manufacturing.length; i++) {
        batt_emissions_vector.push(battery_emissions_manufacturing[i][vehicle_type])
        batt_mass_fraction.push(battery_emissions_manufacturing[i][emissions_type])
    }

    var vehi_sum = weighted_emissions_calc(vehicle_weight, veh_mass_fraction, veh_emissions_vector)     
    
    if (vehicle_type === 'ICE_conv' || vehicle_type === 'HEV_conv') {
        var battery_sum = 0
        var fluids = 634200

    } else if (vehicle_type === 'PHEV_conv') {
        var battery_sum = weighted_emissions_calc(battery_weight, batt_mass_fraction, batt_emissions_vector) 
        var fluids = 571000

    } else {
        var battery_sum = weighted_emissions_calc(battery_weight, batt_mass_fraction, batt_emissions_vector)
        var fluids = 82000
    }

    if (emissions_type === 'CO2') {
        // terms assumed constant:
        var lead_acid_battery = 60000
        var vehicle_adr = 874000
        battery_sum += lead_acid_battery
        var total_embodied = vehi_sum + battery_sum + fluids + vehicle_adr
        return [battery_sum, vehi_sum, total_embodied]

    } else { // assume for other emittants the constant terms are negible (don't add them)
        var total_embodied = vehi_sum + battery_sum
        return [battery_sum, vehi_sum, total_embodied]
    }
}

function get_usage_emissions(Vehicle, vehicle_fuel_economy, vehicle_class, miles_estimated, grid_intensity) {
    if (vehicle_class === 'ICE' || vehicle_class === 'HEV') {
        var usage_emissions =  (vehicle_fuel_economy ** -1) * miles_estimated * 8900 // (g/mile*miles*8900gCo2/gallon)
        return usage_emissions
    } else if (vehicle_class === 'EV') {
        var grid_carbon = grid_intensity * ((vehicle_fuel_economy / 33.7) ** -1) * miles_estimated 
        //convert mpge to kwh/mile, return gC
        return grid_carbon //carbon per kwh*kwh/gallon
    } else if (vehicle_class === 'PHEV') { //assume vehicle is driven in combined cycle (battery and engine)
        return get_PHEV_usage_emissions(Vehicle, miles_estimated, grid_intensity) // 8.9 kgC02 per gallon
    } else {
        return 0
    }
}

function conv_or_lw(vehicle_class, lightweight = false) {
//input vehicle_class (Vehicle.atvType) and Boolean (lightweight = False for conventional)'''


    // const possible_columns = ['ICEV: Conventional Material', 'ICEV: Lightweight Material',
    // 'HEV: Conventional Material', 'HEV: Lightweight Material',
    // 'PHEV: Conventional Material', 'PHEV: Lightweight Material',
    // 'EV: Conventional Material', 'EV: Lightweight Material',
    // 'FCV: Conventional Material', 'FCV: Lightweight Material']

    const possible_columns = ["ICE_conv", "ICE_lw", "HEV_conv", "HEV_lw", "PHEV_conv",
     "PHEV_lw", "EV_conv", "EV_lw", "FCV_conv", "FCV_lw"]

    if (lightweight !== true) {
        if (vehicle_class === 'ICE') {
            return possible_columns[0]
        } else if (vehicle_class === 'HEV') {
            return possible_columns[2]
        } else if (vehicle_class === 'PHEV') {
            return possible_columns[4]
        } else if (vehicle_class === 'EV') {
            return possible_columns[6]
        } else {
            return possible_columns[8]
        }
    } else if (lightweight === true) {
        if (vehicle_class === 'ICE') {
            return possible_columns[1]
        } else if (vehicle_class === 'HEV') {
            return possible_columns[3]
        } else if (vehicle_class === 'PHEV') {
            return possible_columns[5]
        } else if (vehicle_class === 'EV') {
            return possible_columns[7]
        } else {
            return possible_columns[9]
        }
    // } else {
    //     print("there was an error with get_emissions_weights lightweight parameter")
    //     return
    }
}



const emittant_dictionary = [{'CO2': 1, 'CH4': 25, 'N2O': 298}] //from IPCC report

function get_CO2e(value, emittant, conversions = emittant_dictionary) {
        //'''given a GHG emittant and a emissions value, return CO2e.
        //Use global-warming-potential at 100 years as a scaling factor'''
        var conv_scale = conversions[0][emittant]
        var CO2e = value * conv_scale
        return CO2e
}


function process_vehicle(Vehicle, Manufacturing, Battery, emissions_types, miles_estimated, grid_intensity) {
    var vehicle_fuel_economy = Vehicle.Highway08U * 0.55 + Vehicle.City08U * 0.45 // combined fuel economy (EPA.gov)
    var vehicle_weight = Vehicle.AdjWeight
    var vehicle_class = Vehicle.atvType
    var vehicle_type = conv_or_lw(vehicle_class)
    var battery_weight = est_battery_weight_from_vehicle(Vehicle)

    var total_embodied = 0
    //var total_battery_assembly = 0
    var total_battery = 0
    var total_vehicle = 0

    for (let i = 0; i < emissions_types.length; i++) {
        var emittant = emissions_types[i]
        var embodied_array = get_embodied_emissions(vehicle_weight, battery_weight, vehicle_type, 
            emittant, Manufacturing, Battery)

        var battery = embodied_array[0]
        var vehicle = embodied_array[1]            
        var batt_assembly = est_battery_assembly_emissions(Vehicle, emittant)
        var total = embodied_array[2]
        battery += batt_assembly
        total += batt_assembly
        var embodied_CO2e = get_CO2e(total, emittant)
        var battery_CO2e = get_CO2e(battery, emittant)
        var vehicle_CO2e = get_CO2e(vehicle, emittant)
        //var battery_assemble_CO2e = get_CO2e(vehicle, emittant)

        total_embodied += embodied_CO2e // for every emittant, add to total
        //total_battery_assembly += battery_assemble_CO2e
        total_battery += battery_CO2e
        total_vehicle += vehicle_CO2e
    }

    // for ICE vehicles, CO2 ~ CO2e
    // for grid mix, select CO2e option

    var usage = get_usage_emissions(Vehicle, vehicle_fuel_economy, vehicle_class, miles_estimated, grid_intensity)
    var total_emissions = total_embodied + usage
    var disposal = total_embodied - (total_battery + total_vehicle)
    var lifetime_emissions = [total_battery, total_vehicle, usage, disposal, total_emissions]

    return lifetime_emissions
}

function findYear(full_data) {
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    var data = full_data.filter(function (el) {
        return el.Year === Number(year_data)  && el.atvType === type_data 
    })
    return data
}

function findICE(full_data) {
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    var type_data = "ICE"
    var data = full_data.filter(function (el) {
        return el.Year === Number(year_data)  && el.atvType === type_data 
    })
    return data
}

function findPHEV(full_data) {
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    var type_data = "PHEV"
    var data = full_data.filter(function (el) {
        return el.Year === Number(year_data)  && el.atvType === type_data 
    })
    return data
}

function findEV(full_data) {
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    var type_data = "EV"
    var data = full_data.filter(function (el) {
        return el.Year === Number(year_data)  && el.atvType === type_data 
    })
    return data
}


//////////////////Processing prep/////////////////////////////////////

function getAvg(data) {
    var emissionsList = []
    for (let i = 0; i < data.length; i++) {
        var cur_vehicle = data[i]
        var cur_emission = process_vehicle(cur_vehicle, manufacturing_data, battery_data, ['CO2', 'CH4', 'N2O'], avg_miles, avg_CO2eRate)
        emissionsList.push(cur_emission[4])
    }
    var avgEmissions = emissionsList.reduce((a, b) => a + b) / emissionsList.length
    return avgEmissions
}

function getUSAvg(data) {
    var emissionsList = []
    for (let i = 0; i < data.length; i++) {
        var cur_vehicle = data[i]
        var cur_emission = process_vehicle(cur_vehicle, manufacturing_data, battery_data, ['CO2', 'CH4', 'N2O'], avg_miles, US_CO2Rate_avg)
        emissionsList.push(cur_emission[4])
    }
    var avgEmissions = emissionsList.reduce((a, b) => a + b) / emissionsList.length
    return avgEmissions
}

function getYearList(data) {
    var emissionsList = []
    for (let i = 0; i < data.length; i++) {
        var cur_vehicle = data[i]
        var cur_emission = process_vehicle(cur_vehicle, manufacturing_data, battery_data, ['CO2', 'CH4', 'N2O'], avg_miles, avg_CO2eRate)
        emissionsList.push(cur_emission[4] / 1000)
    }
    return emissionsList
}

function getVehicle(full_data) {
    let year = document.getElementById("selYear")
    var year_data = year.options[year.selectedIndex].text
    let type = document.getElementById("selType")
    var type_data = type.options[type.selectedIndex].text
    let make = document.getElementById("selMake")
    var make_data = make.options[make.selectedIndex].text
    let model = document.getElementById("selModel")
    var model_data = model.options[model.selectedIndex].text
    var configuration = document.getElementById("config_res").innerHTML
    var data = full_data.filter(function (el) {
        return el.Year === Number(year_data)  && el.atvType === type_data && el.Make === make_data && el.Model === model_data && el.Config === configuration
    })
    return data[0]
}

function emissions_eval(data, ice, phev, bev, USice, USphev, USbev) {//, yearEmi) { // change to kgs
    document.getElementById("totalEmissions").innerHTML = data[4] / 1000
    document.getElementById("totalBattery").innerHTML = data[0] / 1000
    document.getElementById("totalVehicle").innerHTML = data[1] / 1000
    document.getElementById("totalUsage").innerHTML = data[2] / 1000
    document.getElementById("totalDisposal").innerHTML = data[3] / 1000
    document.getElementById("roundedEmissions").innerHTML = Math.round((data[4] / 1000) * 100) / 100
    document.getElementById("ICEemissionAvg").innerHTML = ice / 1000
    document.getElementById("PHEVemissionAvg").innerHTML = phev / 1000
    document.getElementById("BEVemissionAvg").innerHTML = bev / 1000
    document.getElementById("USICEemissionAvg").innerHTML = USice / 1000
    document.getElementById("USPHEVemissionAvg").innerHTML = USphev / 1000
    document.getElementById("USBEVemissionAvg").innerHTML = USbev / 1000
    //document.getElementById("histarray").innerHTML = yearEmi
}


//////////////////////////////// Ajax library ///////////////////////////////

function ajaxCall1(){
    $.ajax({
        method: "GET",
        url:'./json/vehicle_data_2023.json',
        success: function(response){
            vehicle_data = getVehicle(response);
            iceList = findICE(response);
            phevList = findPHEV(response)
            bevList = findEV(response)
            yearList = findYear(response)
            ajaxCall2();
        }
    });
}
function ajaxCall2(){
    $.ajax({
        method: "GET",
        url: './json/vehicle_emissions_data.json',
        success: function(response){
            manufacturing_data = response
            ajaxCall3();
        }
    });
}
function ajaxCall3(){
    $.ajax({
        method: "GET",
        url: './json/LI_emissions_data.json',
        success: function(response){
            battery_data = response
            vehicle_emissions_array = process_vehicle(vehicle_data, manufacturing_data, battery_data, ['CO2', 'CH4', 'N2O'], avg_miles, avg_CO2eRate);
            avgICE = getAvg(iceList);
            avgPHEV = getAvg(phevList);
            avgBEV = getAvg(bevList);
            USavgICE = getUSAvg(iceList)
            USavgPHEV = getUSAvg(phevList)
            USavgBEV = getUSAvg(bevList)
            //yearEmissions = getYearList(yearList)
            emissions_eval(vehicle_emissions_array, avgICE, avgPHEV, avgBEV, USavgICE, USavgPHEV, USavgBEV);//, yearEmissions);
            outputViz()
        }
    });
}
